!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).GDL={})}(this,(function(e){"use strict";class t{constructor(){this.events={}}on(e,t){this.events[e]||(this.events[e]=[]),this.events[e].push(t)}off(e,t){this.events[e]&&(this.events[e]=this.events[e].filter((e=>e!==t)))}emit(e,...t){if(this.events[e])for(const o of this.events[e])o(...t)}}class o extends t{constructor(){super(...arguments),this.plugins=[]}static playSound(){try{const e=new Audio("data:audio/wav;base64,UklGRigAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=");e.volume=.3,e.play()}catch(e){console.warn("Sound play failed",e)}}static vibrate(){"vibrate"in navigator&&navigator.vibrate([100,50,100])}static formatSize(e){return e<1024?`${e} B`:e<1048576?`${(e/1024).toFixed(1)} KB`:e<1073741824?`${(e/1048576).toFixed(1)} MB`:`${(e/1073741824).toFixed(1)} GB`}static formatSpeed(e){return e<1024?`${e.toFixed(0)} B/s`:e<1048576?`${(e/1024).toFixed(1)} KB/s`:`${(e/1048576).toFixed(1)} MB/s`}static async getFileSize(e){try{return+((await fetch(e,{method:"HEAD"})).headers.get("Content-Length")||0)}catch(t){return console.warn("Failed to get file size",t),0}}static async downloadWithProgress(e,t){var i;const n=await fetch(e),a=null==(i=n.body)?void 0:i.getReader(),l=+(n.headers.get("Content-Length")||0);let d=0,s=Date.now(),r=0;const c=[];for(;;){const{done:e,value:i}=await a.read();if(e)break;if(c.push(i),d+=i.length,t){const e=Date.now(),i=(e-s)/1e3,n=i>0?(d-r)/i:0;t({total:l,loaded:d,percentage:l>0?d/l*100:0,speed:o.formatSpeed(n)}),s=e,r=d}}return new Blob(c)}registerPlugin(e){this.plugins.push(e),e.init(this)}async initDownload(e){var t;const i=document.getElementById(e.buttonId);if(!i)return void console.warn(`Button with id "${e.buttonId}" not found`);const{waitTime:n=3,messages:a={waiting:"Preparing file...",ready:"Download now!",downloading:"Downloading..."},enableSound:l=!0,enableVibration:d=!0,theme:s="auto",analytics:r,url:c,urls:u,showProgress:w=!1,progressCallback:f,showFileSize:g=!0,showDownloadSpeed:h=!0}=e;("dark"===s||"auto"===s&&window.matchMedia("(prefers-color-scheme: dark)").matches)&&i.classList.add("gdl-dark"),i.disabled=!0,i.textContent=a.waiting;const p=u?u[0]:c,v={apk:"📱",exe:"💻",zip:"🗜️",pdf:"📄",rar:"🗜️",mp3:"🎵",mp4:"🎥",iso:"📀",dmg:"🍏",deb:"🐧",default:"📥"},m=v[(null==(t=null==p?void 0:p.split(".").pop())?void 0:t.toLowerCase())||""]||v.default;let b=n;const y=(e,t="")=>{i.innerHTML=`${m} ${e}${t?`<br><small>${t}</small>`:""}`};let A=0;if(g&&(c||(null==u?void 0:u[0])))try{A=await o.getFileSize(c||u[0])}catch($){console.warn("Failed to get file size",$)}const k=A>0?` (${o.formatSize(A)})`:"";y(a.waiting,k);const S=setInterval((()=>{var e;b--,b>0?(y(`${a.waiting} (${b})`,k),this.emit("countdown",b)):(clearInterval(S),i.disabled=!1,y(a.ready,k),this.emit("ready"),l&&o.playSound(),d&&o.vibrate(),(null==r?void 0:r.gaTrackingId)&&window.gtag&&window.gtag("event","download_ready",{file_url:c||(null==u?void 0:u.join(",")),file_size:A}),null==(e=null==r?void 0:r.customTracker)||e.call(r,"download_ready",{url:c,urls:u,fileSize:A}))}),1e3);i.onclick=async()=>{var e;if(!i.disabled){if(w&&(c||u&&1===u.length)){i.disabled=!0;const e=c||u[0];y(a.downloading||"Downloading...","0%");try{const t=await o.downloadWithProgress(e,(e=>{const t=[`${e.percentage.toFixed(1)}%`,g&&`${o.formatSize(e.loaded)}/${o.formatSize(e.total)}`,h&&e.speed].filter(Boolean).join(" | ");y(a.downloading||"Downloading...",t),f&&f(e)})),i=document.createElement("a");i.href=URL.createObjectURL(t),i.download=e.split("/").pop()||"download",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(i.href),this.emit("download_complete",{url:e,size:t.size})}catch(t){return y("Download failed","Please try again"),this.emit("download_error",{url:e,error:t}),void console.error("Download failed:",t)}}else if(u&&u.length>1)u.forEach((e=>window.open(e,"_blank")));else{if(!c)return void console.warn("No download URL provided");window.location.href=c}this.emit("download_click"),(null==r?void 0:r.gaTrackingId)&&window.gtag&&window.gtag("event","download_click",{file_url:c||(null==u?void 0:u.join(",")),file_size:A}),null==(e=null==r?void 0:r.customTracker)||e.call(r,"download_click",{url:c,urls:u,fileSize:A})}}}}"undefined"!=typeof window&&(window.GDL=o),e.GDL=o,e.default=o,Object.defineProperties(e,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}})}));
//# sourceMappingURL=gdl.umd.js.map
